---
layout: post
title: Exploting Windows Kernel/Intel x64 SYSRET Vulnerability
date: 2012-08-25 23:28
author: Shahriyar Jalayeri
comments: true
categories: [oldblog, exploiting, kernel]
---



<br><br>Hi again,
<br>This time I worked on Kernel-Land a little. Microsoft Windows Kernel Intel x64 SYSRET Vulnerability (MS12-042) was only exploited by VUPEN, apparently! But no PoC or exploit publicly available. So I decided to work on this challenge just for fun.At first glance, it was difficult to get Code-Execution but after several times struggling with Windbg I finally succeeded on triggering the bug and get code-execution. By the way, Windbg had stupid bug on executing SWAPGS by single-stepping! I don't really know why, but the guest VM always reboots! I managed to get it to work with IDA Pro + GDB remote Debugging plugin after all!
<br><br>So, anyway, here is the <a href="http://www.youtube.com/watch?v=U-AWUPRcvRg">demonstration</a> on Youtube.
<br><br>The shellcode disables Code Signing and will grant NT SYSTEM privilege to specified Application or already running process (PID),Â after successfully running exploit, I demonstrated installing an unsigned Driver (which Dbgprints "Microsoft eats it own <a href="http://en.wikipedia.org/wiki/Eating_your_own_dog_food" target="_blank">dog food</a>") and granting NT SYSTEM privilege to cmd.exe .

<img src="https://www.exploit-db.com/screenshots/idlt21000/screen-shot-2012-08-27-at-100534-am.png" alt="">

<br><br><em><strong>WARNING: This is only a proof-of-concept, although its programmed to be very reliable, I won't take any responsibility of any damage or abuse. Sorry kids!</strong></em>
<br>Here are <a href="https://gitlab.com/shahjal/sysret-exp">source codes</a>.

<em><strong>UPDATE : I've just tested the exploit on Windows 2008 R2 SP1 x64, exploit works like a charm without any modification.</strong></em>

--- 

<p><strong>This is imported from my old WP blog, some links might be broken, <a href="https://repret.wordpress.com/2012/08/25/windows-kernel-intel-x64-sysret-vulnerability-code-signing-bypass-bonus/">original post</a>.</strong></p>
